<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultimate Territorial.io Clone</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#101010;color:white;font-family:sans-serif;}
canvas{display:block;background:#181818;border:2px solid #333;margin:auto;image-rendering:pixelated;}
#ui{position:fixed;top:10px;left:50%;transform:translateX(-50%);text-align:center;}
button{background:#333;color:white;border:none;padding:6px 10px;margin:4px;border-radius:6px;cursor:pointer;}
button:hover{background:#555;}
#sendValue{font-weight:bold;margin-left:5px;}
</style>
</head>
<body>
<div id="ui">
<h2>Ultimate Mini Territorial.io</h2>
<p>Click to expand your territory. Conquer all!</p>
<label>Send %:<input type="range" id="sendPercent" min="10" max="100" step="10" value="50"><span id="sendValue">50%</span></label>
<button onclick="restart()">Restart</button>
<div id="leaderboard"></div>
</div>
<canvas id="game" width="1000" height="600"></canvas>
<script>
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
const leaderboard=document.getElementById("leaderboard");
const sendSlider=document.getElementById("sendPercent"),sendValue=document.getElementById("sendValue");
const TILE=8,COLS=200,ROWS=150;
let grid=[],players=[],running=true,camera={x:0,y:0},playerId=0,sendPercent=50;

sendSlider.oninput=()=>{sendPercent=parseInt(sendSlider.value);sendValue.textContent=sendPercent+"%";};

function randColor(){const r=()=>Math.floor(Math.random()*200+30);return`rgb(${r()},${r()},${r()})`;}
function randName(){const n=["Alpha","Bravo","Charlie","Delta","Echo","Foxtrot"];return n[Math.floor(Math.random()*n.length)];}
function makeGrid(){grid=[];for(let y=0;y<ROWS;y++){let row=[];for(let x=0;x<COLS;x++)row.push({owner:null,troops:0});grid.push(row);}}
function spawnPlayers(){players=[];for(let i=0;i<6;i++){let x=Math.floor(Math.random()*COLS),y=Math.floor(Math.random()*ROWS);
let color=randColor(),name=randName();players.push({id:i,color,name:name,alive:true,cells:[],score:0});grid[y][x]={owner:i,troops:10};}}
function getNeighbors(x,y){const dirs=[[1,0],[-1,0],[0,1],[0,-1]];return dirs.map(d=>[x+d[0],y+d[1]]).filter(([nx,ny])=>nx>=0&&ny>=0&&nx<COLS&&ny<ROWS);}
function expand(p){if(!p.alive)return;let owned=[];for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++)if(grid[y][x].owner===p.id)owned.push([x,y]);
if(owned.length===0){p.alive=false;return;}let [x,y]=owned[Math.floor(Math.random()*owned.length)];let nbs=getNeighbors(x,y);
let [nx,ny]=nbs[Math.floor(Math.random()*nbs.length)];let t=grid[ny][nx];
if(t.owner===null){t.owner=p.id;t.troops=10;}else if(t.owner!==p.id){if(t.troops<=5){t.owner=p.id;t.troops=10;}else t.troops-=5;}}
function aiTurn(){players.slice(1).forEach(p=>{if(Math.random()<0.7)expand(p);});}
canvas.addEventListener("click",e=>{if(!running)return;const rect=canvas.getBoundingClientRect();const x=Math.floor((e.clientX-rect.left)/TILE);
const y=Math.floor((e.clientY-rect.top)/TILE);let c=grid[y+camera.y>>0][x+camera.x>>0];if(c.owner!==playerId){c.owner=playerId;c.troops=10;}});
function recalc(){players.forEach(p=>{p.cells=[];p.score=0;});for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++){let v=grid[y][x].owner;
if(v!=null){players[v].cells.push([x,y]);players[v].score++;}}players.forEach(p=>p.alive=p.score>0);}
function updateUI(){let sorted=players.filter(p=>p.alive).sort((a,b)=>b.score-a.score);leaderboard.innerHTML="<b>Leaderboard</b><br>"+
sorted.map(p=>`<span style="color:${p.color}">${p.name}</span>: ${p.score}`).join("<br>");}
function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
let cx=camera.x|0,cy=camera.y|0;
for(let y=0;y<canvas.height/TILE;y++){for(let x=0;x<canvas.width/TILE;x++){let gx=x+cx,gy=y+cy;if(gx>=COLS||gy>=ROWS)continue;
let c=grid[gy][gx];ctx.fillStyle=c.owner!=null?players[c.owner].color:"#111";ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
if(c.owner!=null){ctx.fillStyle="white";ctx.font="7px sans-serif";ctx.fillText(c.troops,x*TILE+1,y*TILE+7);}}}}
function handleCamera(){const p=players[playerId];if(p.cells.length>0){let sumX=0,sumY=0;p.cells.forEach(([x,y])=>{sumX+=x;sumY+=y;});
let centerX=sumX/p.cells.length,centerY=sumY/p.cells.length;camera.x+=(centerX-canvas.width/TILE/2-camera.x)*0.05;
camera.y+=(centerY-canvas.height/TILE/2-camera.y)*0.05;}}
function update(){
if(!running)return;aiTurn();recalc();handleCamera();draw();updateUI();
if(players.filter(p=>p.alive).length<=1){running=false;ctx.fillStyle="white";ctx.font="32px sans-serif";
ctx.fillText("Game Over!",canvas.width/2-90,canvas.height/2);ctx.fillText(`Winner: ${players.filter(p=>p.alive)[0].name}`,canvas.width/2-110,canvas.height/2+40);}
if(running)requestAnimationFrame(update);}
function restart(){running=true;makeGrid();spawnPlayers();camera={x:0,y:0};update();}
restart();
</script>
</body>
</html>
